#!/bin/bash

inotifywait -m . --exclude "[^m]$" -e create -e moved_to |
	while read path event filename; do

		echo "Rerunning $filename..."

		# Remove file extension
		filename="${filename%.*}"

		matlab_wid=($(xdotool search --desktop $(xdotool get_desktop) --class matlab))
		matlab_wid=${matlab_wid[*]: -1}

		# Open new tab and paste file path
		xdotool windowfocus --sync $matlab_wid
		xdotool windowactivate --sync $matlab_wid type --delay 0 $filename
		xdotool windowactivate --sync $matlab_wid key Return

		xdotool windowminimize $matlab_wid

		echo "Done."
	done
